<!DOCTYPE html>
<html lang="en" style="background: #ffffff;">
<head>
  <style type="text/css">
    :root {
      --blue: #00A5C8;
      --pink: #ED6EA7;
      --red: #E62249;
      --green: #00A470;
      --yellow: #FFD744;
      --cotton: #FAF5DC;
      --white: #ffffff;
      --light-grey: #DBE2DF;
      --dark-grey: #07292B;
      --black: #000000;
    }         
  </style>
  <link type="text/css" rel="stylesheet" href="global.css" />
  <link type="text/css" rel="stylesheet" href="main.css" />
  <style type="text/css">
    .time { color: var(--{{{Colour-Theme}}}) }
  </style>
</head>

<body>
  <div class="page ct-{{{Colour-Theme}}} stencil-yes">
    <div class="bleed">
      <div class="fit wrapper">
        <div class="bg-0"></div>        
        <div class="bg-1">{{{Background-Image-1}}}</div>
        <div class="bg-2">{{{Background-Image-2}}}</div>
        <div class="bg-3">{{{Background-Image-3}}}</div>
        <div class="bg-4">{{{Background-Image-4}}}</div>
        <div class="bg-5">{{{Background-Image-5}}}</div>
        <div class="ct-1">
          {{#FB-Time-1}}
          <div class="box-limit time ct-1-time">
            <div class="box-inner">
              {{{FB-Time-1}}}
            </div>
          </div>
          {{/FB-Time-1}}
          {{#FB-Text-1}}
          <div class="box-limit text ct-1-text">
            <div class="box-inner">
              {{{FB-Text-1}}}
            </div>
          </div>
          {{/FB-Text-1}}
        </div>
        <div class="ct-2">
          {{#FB-Time-2}}
          <div class="box-limit time ct-2-time">
            <div class="box-inner">
              {{{FB-Time-2}}}
            </div>
          </div>
          {{/FB-Time-2}}
          {{#FB-Text-2}}
          <div class="box-limit text ct-2-text">
            <div class="box-inner">
              {{{FB-Text-2}}}
            </div>
          </div>
          {{/FB-Text-2}}
        </div>
        <div class="ct-3">
          {{#FB-Text-3}}
          <div class="box-limit text ct-3-text">
            <div class="box-inner">
              {{{FB-Text-3}}}
            </div>
          </div>
          {{/FB-Text-3}}
        </div>
        <div class="ct-4">
          {{#FB-Time-4}}
          <div class="box-limit time ct-4-time">
            <div class="box-inner">
              {{{FB-Time-4}}}
            </div>
          </div>
          {{/FB-Time-4}}
          {{#FB-Text-4}}
          <div class="box-limit text ct-4-text">
            <div class="box-inner">
              {{{FB-Text-4}}}
            </div>
          </div>
          {{/FB-Text-4}}
        </div>
        <div class="ct-5">
          {{#FB-Time-5}}
          <div class="box-limit time ct-5-time">
            <div class="box-inner">
              {{{FB-Time-5}}}
            </div>
          </div>
          {{/FB-Time-5}}
          {{#FB-Text-5}}
          <div class="box-limit text ct-5-text">
            <div class="box-inner">
              {{{FB-Text-5}}}
            </div>
          </div>
          {{/FB-Text-5}}
        </div>
        <div class="separators">
          <span></span>
          <span></span>
          <span></span>
          <span></span>
        </div>
      </div>
      <div class="fit test contain .d-none"></div>
      <div class="fit boundary"></div>
    </div>
  </div>

  <script>
    const showCrop = '{{show-crop}}' === 'true';    

    function cropMarks(showCrop) {
      if (showCrop) {
        document.querySelector('body').classList.add('crop');
      }

      Array.prototype.slice.call(document.querySelectorAll('.page')).forEach(function (page) {
        const parser = new DOMParser();
        const cropString = '<div class="crop-marks"><span class="cm1"></span><span class="cm2"></span><span class="cm3"></span><span class="cm4"></span></div>';
        const cropNode = parser.parseFromString(cropString, "text/html").body.firstChild;
        !!showCrop && page.insertBefore(cropNode, null);
      });
    }

    function getSize() {
      const vw = (showCrop ? window.innerWidth : window.innerWidth + 57.62) / 100;
      const vh = (showCrop ? window.innerHeight : window.innerHeight + 57.62) / 100;
      const vmin = Math.min(vw, vh);
      const vmax = Math.max(vw, vh);
      return ((vmin * 2) + (vmax * 5) + (vh * 2)) / 1.79186;
    }

    function setSize() {
      const size = getSize();
      document.documentElement.style.fontSize = `${size}px`;
    };

    function heightObservable() {
      Array.prototype.slice.call(document.querySelectorAll('.box-limit .box-inner')).forEach(function (e) {
        checkHeight(e);
      });
    }

    function checkHeight(element) {
      const elementHeight = element.getBoundingClientRect().height;
      const parent = element.parentElement;
      const parentHeight = parent.getBoundingClientRect().height;

      if (elementHeight > parentHeight) {
        parent.classList.add('overflow');
      } else {
        parent.classList.remove('overflow');
      }
    }
    
    function specialWording(selector) {
      const elements = document.querySelectorAll(selector);
      Array.prototype.slice.call(elements).forEach(function (e) {
        if (!e.getElementsByClassName('txt-stencil').length) {
          const newHTML = e.innerHTML.replace(/sheffield/gi, '<span class="txt-stencil">$&</span>');          
          if (newHTML !== e.innerHTML) {            
            e.innerHTML = newHTML;
          }
        }
      });
    }

    cropMarks(showCrop);
    setSize();
    specialWording('.stencil-yes .text');

    window.addEventListener('resize', function () {
      setSize();
    });

    window.addEventListener('load', function () {
      heightObservable();
    });

    window.addEventListener('DOMSubtreeModified', function () {
      specialWording('.stencil-yes .text token-value');
      heightObservable();
    });    
  </script>
</body>

</html>
